<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-ocp_topology/ocp_setup">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">OCP Clusters Implementation | OCP on Nutanix</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://github.com/ocp-gitp/ocp_topology/ocp_setup"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="OCP Clusters Implementation | OCP on Nutanix"><meta data-rh="true" name="description" content="We will use User Provisioned Install (UPI) method to deploy a OCP cluster. We are choosing this UPI for the time being as Installer Provisioned Install is unable to span over multiple Prism Element clusters at the time of writing this workshop."><meta data-rh="true" property="og:description" content="We will use User Provisioned Install (UPI) method to deploy a OCP cluster. We are choosing this UPI for the time being as Installer Provisioned Install is unable to span over multiple Prism Element clusters at the time of writing this workshop."><link data-rh="true" rel="icon" href="/ocp-gitp/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://github.com/ocp-gitp/ocp_topology/ocp_setup"><link data-rh="true" rel="alternate" href="https://github.com/ocp-gitp/ocp_topology/ocp_setup" hreflang="en"><link data-rh="true" rel="alternate" href="https://github.com/ocp-gitp/ocp_topology/ocp_setup" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/ocp-gitp/blog/rss.xml" title="OCP on Nutanix RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/ocp-gitp/blog/atom.xml" title="OCP on Nutanix Atom Feed"><link rel="stylesheet" href="/ocp-gitp/assets/css/styles.25d0301d.css">
<link rel="preload" href="/ocp-gitp/assets/js/runtime~main.2407ab37.js" as="script">
<link rel="preload" href="/ocp-gitp/assets/js/main.623d6065.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(e){}return e}()||function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/ocp-gitp/"><div class="navbar__logo"><img src="/ocp-gitp/img/logo.svg" alt="OCP on Nutanix Bootcamp" class="themedImage_ToTc themedImage--light_HNdA"><img src="/ocp-gitp/img/logo.svg" alt="OCP on Nutanix Bootcamp" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">OCP on Nutanix Bootcamp</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/nutanix-japan/ocp-gitp" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>OCP Clusters Implementation</h1><p>We will use User Provisioned Install (UPI) method to deploy a OCP cluster. We are choosing this UPI for the time being as Installer Provisioned Install is unable to span over multiple Prism Element clusters at the time of writing this workshop. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ocp-network-requirements">OCP Network Requirements<a href="#ocp-network-requirements" class="hash-link" aria-label="Direct link to OCP Network Requirements" title="Direct link to OCP Network Requirements">​</a></h2><p>The following comprises network components:</p><ul><li><p>Reserve black-listed IPs in your subnet for the following components: </p><ul><li>OCP API IP endpoint</li><li>OCP Ingress IP endpoint</li></ul></li><li><p>Find 2 free IPs in your AHV network. Once you find the free IPs, add it to AHV DHCP black-list. Refer to the process <a href="/ocp-gitp/ocp_ipi_install/ocp_ipi_pre_reqs#ahv-networking">here</a> for setting this up.</p></li><li><p>Add DNS resolution for these OCP API and Ingress endpoints. Refer to the process <a href="/ocp-gitp/ocp_ipi_install/ocp_ipi_pre_reqs#add-dns-records">here</a> for setting this up.</p></li><li><p>Depending on the number of Master and Worker OCP VMs, get AHV network&#x27;s DHCP option to allocate an IP for the following</p><ul><li>Master VMs </li><li>Worker VMs</li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="create-ocp-vms">Create OCP VMs<a href="#create-ocp-vms" class="hash-link" aria-label="Direct link to Create OCP VMs" title="Direct link to Create OCP VMs">​</a></h2><p>We have used Terraform <a href="https://github.com/nutanix-japan/tf-ocp-infra" target="_blank" rel="noopener noreferrer">script</a> to create OCP master and worker VMs accross the three Nutanix clusters. This are assumed to be inter-region clusters for demonstration purposes. </p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>ocp hardware requirements</div><div class="admonitionContent_S0QG"><p>All VMs should conform to OCP&#x27;s minimum hardware requirements. See <a href="https://docs.openshift.com/container-platform/3.11/install/prerequisites.html" target="_blank" rel="noopener noreferrer">OCP Hardware Requirements</a> for more details.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ocp-software">OCP Software<a href="#ocp-software" class="hash-link" aria-label="Direct link to OCP Software" title="Direct link to OCP Software">​</a></h2><p>We have used OCP Assited Installer clusters implementation to install OCP software. </p><blockquote><p>You will need a Red Hat Console portal account for this</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ocp-installation">OCP Installation<a href="#ocp-installation" class="hash-link" aria-label="Direct link to OCP Installation" title="Direct link to OCP Installation">​</a></h2><p>The following steps include OCP installation:</p><ul><li>Logon to RedHat console <a href="https://console.redhat.com" target="_blank" rel="noopener noreferrer">https://console.redhat.com</a> to create a OCP install cluster</li><li>Add OCP hosts</li><li>Upload SSH public key and get link to download the installation ISO</li><li>Boot the VMs from the installation ISO and wait for RedHat console to detect the OCP VMs<ul><li>Need outboud internet connectivity and presence of following components<ul><li>DNS servers</li><li>Gateways </li><li>Real time internet connectivity to the outside world</li></ul></li></ul></li><li>Choose the master (control plane) and worker vm roles from the Assited Installer GUI</li><li>Proceed to install and monitor</li><li>OCP Assisted install will request to eject theinstallation ISO and logon to the boot disk after the intial boot drive write process</li><li>Monitor and complete installation</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ocp-access">OCP Access<a href="#ocp-access" class="hash-link" aria-label="Direct link to OCP Access" title="Direct link to OCP Access">​</a></h2><p>We will use the following steps to access OCP cluster:</p><ol><li><p>Download the kubeconfig from RedHat console <a href="https://console.redhat.com" target="_blank" rel="noopener noreferrer">https://console.redhat.com</a> <strong>OCP Clusters</strong> &gt; <strong>Assisted Install Clusters</strong></p></li><li><p>Logon to any one of the VMs in the same network</p><ul><li>If logging on to OCP VMs, use the private key part of the key pair that you used to generate installation ISO</li></ul></li><li><p>Place the downloaded kubeconfig file to <code>/home/core/</code>directory of the VM</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">KUBECONFIG</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/home/core/kubeconfig </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Test access by running the following commands:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">oc get nodes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">oc get cluster-info</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Make sure the commands work and you are all set to install latest version of Nutanix CSI</p></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="connect-idp-ad-to-ocp">Connect IDP (AD) to OCP<a href="#connect-idp-ad-to-ocp" class="hash-link" aria-label="Direct link to Connect IDP (AD) to OCP" title="Direct link to Connect IDP (AD) to OCP">​</a></h2><p>Refer to <a href="/ocp-gitp/optional_labs/ocp_idp">this</a> section for connecting AD to OCP for user authentication and authorizatino. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="install-nutanix-storage-csi">Install Nutanix Storage CSI<a href="#install-nutanix-storage-csi" class="hash-link" aria-label="Direct link to Install Nutanix Storage CSI" title="Direct link to Install Nutanix Storage CSI">​</a></h2><ol><li><p>Download the following </p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/subodh01/helm.git</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Edit the following environment details in the <code>values.yaml</code> file</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">vi</span><span class="token plain"> charts/nutanix-csi-storage/values.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Openshift settings - as we using openshift</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">openshift:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  scc: </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  masterIscsiConfig: </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  workerIscsiConfig: </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># kubeletDir allows overriding the host location of kubelet&#x27;s internal state.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubeletDir: </span><span class="token string" style="color:#e3116c">&quot;/var/lib/kubelet/&quot;</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># &lt;&lt; change to suit OCP kubelet director y&gt;&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">volumeClass: </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">volumeClassName: </span><span class="token string" style="color:#e3116c">&quot;nutanix-volume&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">volumeClassRetention: </span><span class="token string" style="color:#e3116c">&quot;Delete&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prismEndPoint: </span><span class="token number" style="color:#36acaa">10.45</span><span class="token plain">.34.226   </span><span class="token comment" style="color:#999988;font-style:italic"># &lt;&lt; change to your Prism Central IP &gt;&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">username: admin               </span><span class="token comment" style="color:#999988;font-style:italic"># &lt;&lt; change to your Prism Central username &gt;&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">password: Nutanix.123         </span><span class="token comment" style="color:#999988;font-style:italic"># &lt;&lt; change to your Prism Central password &gt;&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Volumes Settings</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Prism Element&#x27;s storage container name should be the same accross all PE in your PC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">storageContainer: default     </span><span class="token comment" style="color:#999988;font-style:italic"># &lt;&lt; change to your Prism element Storage Container name &gt;&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fsType: ext4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><ol start="3"><li><p>Install using helm</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> helm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> -n ntnx-system -f charts/nutanix-csi-storage/values.yaml nutanix-csi ./charts/nutanix-csi-storage</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Output</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">NAME: nutanix-csi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LAST DEPLOYED: Thu Jan </span><span class="token number" style="color:#36acaa">12</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">12</span><span class="token plain">:44:35 </span><span class="token number" style="color:#36acaa">2023</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAMESPACE: ntnx-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">STATUS: deployed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REVISION: </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TEST SUITE: None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NOTES:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Driver name: csi.nutanix.com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Make sure the pods are running in <code>ntnx-system</code> namespace/project</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">oc get po -n ntnx-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                            READY   STATUS    RESTARTS      AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">csi-node-ntnx-plugin-5z5gd      </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">/3     Running   </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">52m ago</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">   60m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">csi-node-ntnx-plugin-77zdt      </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">/3     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">             60m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">csi-node-ntnx-plugin-85f5p      </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">/3     Running   </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">56m ago</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">   60m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">csi-node-ntnx-plugin-9kl52      </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">/3     Running   </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">54m ago</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">   60m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">csi-node-ntnx-plugin-9mxt8      </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">/3     Running   </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">55m ago</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">   60m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">csi-node-ntnx-plugin-r4kwt      </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">/3     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">             60m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">csi-node-ntnx-plugin-s6js6      </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">/3     Running   </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">59m ago</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">   60m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">csi-node-ntnx-plugin-vknqh      </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">/3     Running   </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">58m ago</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">   60m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">csi-node-ntnx-plugin-zm9fc      </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">/3     Running   </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">50m ago</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">   60m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">csi-provisioner-ntnx-plugin-0   </span><span class="token number" style="color:#36acaa">7</span><span class="token plain">/7     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">             57m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Make nutanix-volume as the default storage class (otherwise feel free to mention storage class in all your manifests)</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ oc patch sc nutanix-volume -p </span><span class="token string" style="color:#e3116c">&#x27;{&quot;metadata&quot;: {&quot;annotations&quot;:{&quot;storageclass.kubernetes.io/is-default-class&quot;:&quot;true&quot;}}}&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Confirm status of Storage Class</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ oc get sc </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># output below</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                      PROVISIONER       RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nutanix-volume</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">   csi.nutanix.com   Delete          WaitForFirstConsumer   </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain">                   1h</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Check for toplogy feature implmentation by looking at the labels of the OCP cluster nodes You can observer the <code>prism-element-uuid</code> label in the output. This will help us in implementing topology for the CSI storage our workload will use.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">oc get nodes --output custom-columns</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">NAME:metadata.name,LABELS:metadata.labels</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Output - OCP cluster’s worker nodes are labeled with prism element uuid</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ocp-worker-3   csi.nutanix.com/prism-element-uuid:0005f16d-6a2d-4b6d-0000-00000001957f kubernetes.io/arch:amd64 kubernetes.io/hostname:ocp-worker-3 kubernetes.io/os:linux node-role.kubernetes.io/worker: node.openshift.io/os_id:rhcos</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ocp-worker-4   csi.nutanix.com/prism-element-uuid:0005f16d-25dd-19a3-0000-00000001b5dc kubernetes.io/arch:amd64 kubernetes.io/hostname:ocp-worker-4 kubernetes.io/os:linux node-role.kubernetes.io/worker: node.openshift.io/os_id:rhcos</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/nutanix-japan/ocp-gitp/edit/main/docs/ocp_topology/ocp_setup.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-05-25T11:00:04.000Z">May 25, 2023</time></b> by <b>Nutanix Japan</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#ocp-network-requirements" class="table-of-contents__link toc-highlight">OCP Network Requirements</a></li><li><a href="#create-ocp-vms" class="table-of-contents__link toc-highlight">Create OCP VMs</a></li><li><a href="#ocp-software" class="table-of-contents__link toc-highlight">OCP Software</a></li><li><a href="#ocp-installation" class="table-of-contents__link toc-highlight">OCP Installation</a></li><li><a href="#ocp-access" class="table-of-contents__link toc-highlight">OCP Access</a></li><li><a href="#connect-idp-ad-to-ocp" class="table-of-contents__link toc-highlight">Connect IDP (AD) to OCP</a></li><li><a href="#install-nutanix-storage-csi" class="table-of-contents__link toc-highlight">Install Nutanix Storage CSI</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Nutanix. Built with Docusaurus.</div></div></div></footer></div>
<script src="/ocp-gitp/assets/js/runtime~main.2407ab37.js"></script>
<script src="/ocp-gitp/assets/js/main.623d6065.js"></script>
</body>
</html>