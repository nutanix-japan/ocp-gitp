<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-ocp_topology/infra_topology">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">IDP and DNS Implementation | OCP on Nutanix</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://github.com/ocp-gitp/ocp_topology/infra_topology"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="IDP and DNS Implementation | OCP on Nutanix"><meta data-rh="true" name="description" content="Design Overview"><meta data-rh="true" property="og:description" content="Design Overview"><link data-rh="true" rel="icon" href="/ocp-gitp/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://github.com/ocp-gitp/ocp_topology/infra_topology"><link data-rh="true" rel="alternate" href="https://github.com/ocp-gitp/ocp_topology/infra_topology" hreflang="en"><link data-rh="true" rel="alternate" href="https://github.com/ocp-gitp/ocp_topology/infra_topology" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/ocp-gitp/blog/rss.xml" title="OCP on Nutanix RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/ocp-gitp/blog/atom.xml" title="OCP on Nutanix Atom Feed"><link rel="stylesheet" href="/ocp-gitp/assets/css/styles.70a3dea8.css">
<link rel="preload" href="/ocp-gitp/assets/js/runtime~main.a3558648.js" as="script">
<link rel="preload" href="/ocp-gitp/assets/js/main.f111c460.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(e){}return e}()||function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/ocp-gitp/"><div class="navbar__logo"><img src="/ocp-gitp/img/logo.svg" alt="OCP on Nutanix Bootcamp" class="themedImage_ToTc themedImage--light_HNdA"><img src="/ocp-gitp/img/logo.svg" alt="OCP on Nutanix Bootcamp" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">OCP on Nutanix Bootcamp</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/nutanix-japan/ocp-gitp" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>IDP and DNS Implementation</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="design-overview">Design Overview<a href="#design-overview" class="hash-link" aria-label="Direct link to Design Overview" title="Direct link to Design Overview">​</a></h2><p>In this section we will look at design decisions that has driven IDP and DNS design.</p><p>One of the primary requirements is to deploy IDP and DNS across multiple Availability Zones (AZ) to tolerate failure. This IDP and DNS services will be used by the OCP cluster and  workloads hosted on it. </p><p>Other requirements could be the following:</p><ul><li>Local storage availability</li><li>IDP and DNS information to replicate across AZ</li><li>Failure of any one AZ will start automated failover of IDP and DNS</li></ul><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>We will not be using Active Directory Federation Services in an attempt to keep the implementation simple. However, please feel free to deploy it if necessary. </p></div></div><p>We will look at deploying a inter-AZ infrastructure services.</p><p>These are the high-level steps we will go through in this section:</p><ol><li>Install 2 x Microsoft AD and DNS servers in AZ1 <ul><li>One Primary AD DNS (DM3-POC009)</li><li>One additional AD DNS (DM3-POC009)</li></ul></li><li>Install 3 x additional AD and DNS server in AZ2, AZ3 and AZ3 to provide redundancy<ul><li>One additional AD DNS (DM3-POC010)</li><li>One additional AD DNS (DM3-POC011)</li><li>One additional AD DNS (DM3-POC013)</li></ul></li></ol><p>We will build the following resilient AD(IDP) and DNS implementation.</p><table><thead><tr><th align="center">Availability Zone (AZ)</th><th align="center">Nutanix Cluster</th><th align="center">Role</th><th align="center">VM Name</th><th align="center">IP Address</th></tr></thead><tbody><tr><td align="center">AZ 1</td><td align="center">DM3-POC009</td><td align="center">Primary DC and DNS</td><td align="center">DC</td><td align="center">10.54.63.51</td></tr><tr><td align="center">AZ 1</td><td align="center">DM3-POC009</td><td align="center">Additional DC and DNS</td><td align="center">DC-AZ1-1</td><td align="center">10.54.63.52</td></tr><tr><td align="center">AZ 2</td><td align="center">DM3-POC010</td><td align="center">Additional DC and DNS</td><td align="center">DC-AZ2-2</td><td align="center">10.54.63.111</td></tr><tr><td align="center">AZ 3</td><td align="center">DM3-POC011</td><td align="center">Additional DC and DNS</td><td align="center">DC-AZ3-3</td><td align="center">10.54.63.151</td></tr><tr><td align="center">AZ 4</td><td align="center">DM3-POC013</td><td align="center">Additional DC and DNS</td><td align="center">DC-AZ4-4</td><td align="center">10.54.63.191</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="pre-requisites">Pre-requisites<a href="#pre-requisites" class="hash-link" aria-label="Direct link to Pre-requisites" title="Direct link to Pre-requisites">​</a></h2><p>You will need the following pre-requisites:</p><ul><li>Access to Windows server OS image </li><li>Basic Windows roles and features installation knowledge</li><li>5x Static IPs chosen for 4 AD+DNS VMs </li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="idp-and-dns-implementation-1">IDP and DNS Implementation<a href="#idp-and-dns-implementation-1" class="hash-link" aria-label="Direct link to IDP and DNS Implementation" title="Direct link to IDP and DNS Implementation">​</a></h2><p>Since you will potentially build this environment using a HPOC/SPOC, we will use the Windows OS images in our DFS share to build these VMs.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="upload-images">Upload Images<a href="#upload-images" class="hash-link" aria-label="Direct link to Upload Images" title="Direct link to Upload Images">​</a></h3><ol><li>Go to <strong>Prism Central</strong> </li><li>In the search window (on top left), enter the text <strong>Images</strong></li><li>Choose the Images option and Click on <strong>Add Image</strong></li><li>Select URL and enter the following <a href="http://10.42.194.11/workshop_staging/autoad.qcow2" target="_blank" rel="noopener noreferrer">AutoAD</a> (right-click and copy URL)</li><li>Paste the URL in the <strong>Enter Image URL</strong> text box</li><li>Click on <strong>Upload File</strong></li><li>Click on <strong>Next</strong></li><li>Choose <strong>Place image directly on clusters</strong></li><li>Select all your three or four clusters (this design uses four clusters) each representing different AZs.</li><li>Click on <strong>Save</strong></li><li>Monitor the progress in the background and make sure the images are available in all four clusters in the three AZ. </li></ol><p>Repeat these steps to upload <a href="http://10.42.194.11/workshop_staging/Windows2019.qcow2" target="_blank" rel="noopener noreferrer">Windows2019</a> (right-click and copy URL) image for the additional domain controllers.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-primary-ad-and-dns-vm">Create Primary AD and DNS VM<a href="#create-primary-ad-and-dns-vm" class="hash-link" aria-label="Direct link to Create Primary AD and DNS VM" title="Direct link to Create Primary AD and DNS VM">​</a></h3><ol><li><p>In <strong>Prism Central</strong> &gt; select <strong>Menu</strong> &gt; <strong>Compute and Storage &gt; VMs</strong>, and click <strong>Create VM</strong></p></li><li><p>Fill out the following fields:</p><ul><li><strong>Name</strong> - DC-AZ1-0</li><li><strong>Description</strong> - (Optional) Description for your VM.</li><li><strong>Cluster</strong> - Choose the AZ1 cluster (DM3-POC009)</li><li><strong>Number of VMs</strong> - 1</li><li><strong>CPU(s)</strong> - 4</li><li><strong>Number of Cores per CPU</strong> - 1</li><li><strong>Memory</strong> - 4 GiB</li></ul></li><li><p>Click <strong>Next</strong></p></li><li><p>Under <strong>Disks</strong> select <strong>Attach Disk</strong></p><ul><li><strong>Type</strong> - DISK</li><li><strong>Operation</strong> - Clone from Image</li><li><strong>Image</strong> - autoad.qcow2</li><li><strong>Capacity</strong> - leave at default size</li><li><strong>Bus Type</strong> - leave at default SCSI Setting</li></ul></li><li><p>Click <strong>Save</strong></p></li><li><p>Under <strong>Networks</strong> select <strong>Attach to Subnet</strong></p><ul><li><strong>VLAN Name</strong> - Primary</li><li><strong>Network Connection State</strong> - Connected</li><li><strong>Assignment Type</strong> - Assign a static IP in your CIDR</li></ul></li><li><p>Click <strong>Save</strong></p></li><li><p>Click <strong>Next</strong> at the bottom</p></li><li><p>In <strong>Management</strong> section</p><ul><li><strong>Categories</strong> - leave blank</li><li><strong>Timezone</strong> - leave at default UTC</li><li><strong>Guest Customization</strong> - No Customization</li></ul></li><li><p>Go back to <strong>Prism Central</strong> &gt; <strong>Menu</strong> &gt; <strong>Compute and Storage</strong> &gt; <strong>VMs</strong></p></li><li><p>Select your <em>Initials</em>-Linux-ToolsVM</p></li><li><p>Under <strong>Actions</strong> drop-down menu, choose <strong>Power On</strong></p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>It may take up to 10 minutes for the VM to be ready.</p><p>You can watch the console of the VM from Prism Central to make sure all the sysprep script has finished running.</p></div></div></li><li><p>Login to the VM via SSH or Console session and confirm the presence of following components :</p><ul><li>Active Directory Users and Computers</li><li>DNS</li><li>Active Directory Sites and Services</li></ul></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="prepare-ad-sites-and-services">Prepare AD Sites and Services<a href="#prepare-ad-sites-and-services" class="hash-link" aria-label="Direct link to Prepare AD Sites and Services" title="Direct link to Prepare AD Sites and Services">​</a></h3><p>We will prepare our Active Directory Sites and Services to reflect our physical AZ.</p><ol><li>Logon to the primary domain controller</li><li>Opens Active Directory Sites and Services</li><li>Create a new site for each AZ as shown in the table below. </li></ol><table><thead><tr><th>AZ</th><th>AD Site Name</th><th>AD Sever</th><th>Notes</th></tr></thead><tbody><tr><td rowspan="2">AZ1</td><td rowspan="2">Default First Site</td><td>DC</td><td rowspan="2">This is automatically created with DC install.</td></tr><tr><td>DC-AZ1-1</td></tr><tr><td>AZ2</td><td>AZ2</td><td>DC-AZ2-2</td><td></td></tr><tr><td>AZ3</td><td>AZ3</td><td>DC-AZ3-3</td><td></td></tr><tr><td>AZ4</td><td>AZ4</td><td>DC-AZ4-4</td><td></td></tr></tbody></table><p>Once you have finished creatin the AZ2, AZ3 and AZ4 sites, the console should looks as follows: </p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>The primary domain controller is by default a part of <strong>Default-First-Site-Name</strong>.</p></div></div><p><img loading="lazy" src="/ocp-gitp/assets/images/ad-sites-0692fd9d0bbb7a8965cc21af93d073c2.png" width="861" height="263" class="img_ev3q"></p><p>We can use these sites to deploy our additional domain controllers.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="implement-dns-best-practices">Implement DNS Best Practices<a href="#implement-dns-best-practices" class="hash-link" aria-label="Direct link to Implement DNS Best Practices" title="Direct link to Implement DNS Best Practices">​</a></h3><p>The following DNS best practices should be implemented in PoC to get a resilient DNS infrastructure.</p><p>On your domain controller, configure your network cards static IP and DNS addresses to suit the best practices.</p><ul><li>Round-robin approach to <strong>Preferred DNS Server</strong>-</li><li>Loop back address to <strong>Alternate DNS Server</strong>-</li><li>All other additional DNS servers including public DNS servers in <strong>Addtional DNS Server</strong></li></ul><p>Here is a summation of what the configuration would like like.</p><table><thead><tr><th>#</th><th>DC Name</th><th>DC IP Address</th><th>Preferred DNS Server</th><th>Alternate DNS Server</th><th>Additional DNS Servers</th></tr></thead><tbody><tr><td>1</td><td>DC</td><td>10.54.63.51</td><td>10.54.63.51</td><td>127.0.0.1</td><td rowspan="5">10.54.63.51,52,111,151,111,8.8.8.8,8.8.4.4</td></tr><tr><td>2</td><td>DC-AZ1-1</td><td>10.54.63.52</td><td>10.54.63.51</td><td>127.0.0.1</td></tr><tr><td>3</td><td>DC-AZ2-2</td><td>10.54.63.111</td><td>10.54.63.52</td><td>127.0.0.1</td></tr><tr><td>4</td><td>DC-AZ3-3</td><td>10.54.63.151</td><td>10.54.63.111</td><td>127.0.0.1</td></tr><tr><td>5</td><td>DC-AZ4-4</td><td>10.54.63.191</td><td>10.54.63.151</td><td>127.0.0.1</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-additional-ad-and-dns-controllers">Deploy Additional AD and DNS Controllers<a href="#deploy-additional-ad-and-dns-controllers" class="hash-link" aria-label="Direct link to Deploy Additional AD and DNS Controllers" title="Direct link to Deploy Additional AD and DNS Controllers">​</a></h3><p>In this section we will deploy additional AD and DNS VMs in AZ1, AZ2 and AZ3. </p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="prepare-vm">Prepare VM<a href="#prepare-vm" class="hash-link" aria-label="Direct link to Prepare VM" title="Direct link to Prepare VM">​</a></h4><p>Deploy an addtional domain controller and DNS VM in AZ1 (DM3-POC009)</p><p>Create a VM with the following details:</p><ol><li>Fill out the following fields:<ul><li><strong>Name</strong> - DC-AZ1-1</li><li><strong>Description</strong> - (Optional) Description for your VM.</li><li><strong>Cluster</strong> - Choose the AZ1 cluster (cluster DM3-POC010)</li><li><strong>Number of VMs</strong> - 1</li><li><strong>CPU(s)</strong> - 4</li><li><strong>Number of Cores per CPU</strong> - 1</li><li><strong>Memory</strong> - 4 GiB</li></ul></li><li>Click <strong>Next</strong></li><li>Under <strong>Disks</strong> select <strong>Attach Disk</strong><ul><li><strong>Type</strong> - DISK</li><li><strong>Operation</strong> - Clone from Image</li><li><strong>Image</strong> - Windows2019</li><li><strong>Capacity</strong> - leave at default size</li><li><strong>Bus Type</strong> - leave at default SCSI Setting</li></ul></li><li>Click <strong>Save</strong></li><li>Under <strong>Networks</strong> select <strong>Attach to Subnet</strong><ul><li><strong>VLAN Name</strong> - Primary</li><li><strong>Network Connection State</strong> - Connected</li><li><strong>Assignment Type</strong> - Assign Static IP</li><li><strong>IP Address</strong> - Assign one IP from you reserved CIDR </li></ul></li><li>Click <strong>Save</strong></li><li>Click <strong>Next</strong> at the bottom  </li><li>In <strong>Management</strong> section<ul><li><strong>Categories</strong> - leave blank</li><li><strong>Timezone</strong> - leave at default UTC</li><li><strong>Guest Customization</strong> - No Customization</li></ul></li><li>Go back to <strong>Prism Central</strong> &gt; <strong>Menu</strong> &gt; <strong>Compute and Storage</strong> &gt; <strong>VMs</strong></li><li>Select your DC-AZ1-01 VM</li><li>Under <strong>Actions</strong> drop-down menu, choose <strong>Power On</strong></li><li>In the welcome screen, set the following: <ul><li>What&#x27;s your home country/region? - United States</li><li>What&#x27;s your preferred app languages? - English (United States)</li><li>What keyboard layout would you like to user? - US</li></ul></li><li>Click Accept in License terms Window</li><li>Set a local administrator password</li><li>Set the static the IP address on the NIC to the following:<ul><li><strong>IP</strong> - 10.54.63.52</li><li><strong>Subnet</strong> - 255.255.255.0</li><li><strong>Gateway</strong> - 10.54.63.1</li><li><strong>Preferred DNS Server</strong>- 10.54.63.51 (the primary domain controller)</li><li><strong>Alternate DNS Server</strong>- 127.0.0.1 (loopback)</li></ul></li><li>Set the hostname name to <strong>DC-AZ1-1</strong> (reboot if required)</li></ol><p>Repeat these steps to create additional domain controllers in AZ2 (DM3-POC010), AZ3 (DM3-POC011) and AZ4(DM3-POC013). </p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="install-additional-domain-controller">Install Additional Domain Controller<a href="#install-additional-domain-controller" class="hash-link" aria-label="Direct link to Install Additional Domain Controller" title="Direct link to Install Additional Domain Controller">​</a></h4><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Reference</div><div class="admonitionContent_S0QG"><p>We have followed <a href="https://activedirectorypro.com/add-secondary-domain-controller/" target="_blank" rel="noopener noreferrer">this</a> article to implement additional domain controllers.</p></div></div><ol><li><p>Open Server Manager</p></li><li><p>Select Role-based or featured-based installation and click Next</p></li><li><p>Select a server from the server pool. Select your server and click Next</p></li><li><p>Select Active Directory Domain Services, you will get a popup to add features that are required for Active Directory Domain Services, click Add features. Click Next</p></li><li><p>Click next on the features page. Nothing additional needs to be selected on this page</p></li><li><p>Click next on the AD DS page. This page is just informational</p></li><li><p>Click Install on the confirmation page </p></li><li><p>Monitor to make sure the installation is complete</p></li><li><p>In the server manager click the yellow icon at the top and click <strong>Promote this server to a domain controller</strong></p></li><li><p>Select “Add a domain controller to an existing domain”</p></li><li><p>Next, enter or select the existing domain (<strong>dc.ntnxlab.local</strong>) you want to add the secondary domain controller to. You will need to click the change button to enter in administrator credentials. Click Next.</p></li><li><p>On the Domain Controller Options page, Domain Name System (DNS) server and Global Catalog (GC) should be checked. The <strong>Default First Site Name</strong> should be selected.</p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>While installing additonal domain controllers in AZ2, AZ3 and AZ4, choose the appropriate site you created in AD Sites and Services <a href="/ocp-gitp/ocp_topology/infra_topology#prepare-ad-sites-and-services"></a> section.</p></div></div></li></ol><p><a href="/ocp-gitp/ocp_topology/infra_topology#prepare-ad-sites-and-services"></a></p><ol start="13"><li>Enter a password for the Directory Services Restore mode and click <strong>Next</strong></li><li>Ignore warnings about delegation and click <strong>Next</strong></li><li>Accept the defaults for the remainder of the configuration and monitor the installation</li></ol><p><strong>Repeat</strong> these steps for other additional domain controllers in your configuration:</p><ul><li><strong>AZ2</strong> - DC-AZ2-2</li><li><strong>AZ3</strong> - DC-AZ3-3</li><li><strong>AZ4</strong> - DC-AZ4-4</li></ul><p>Once you have finished adding all other addtional domain controllers and DNS the configuration should look as follows:</p><p><strong>AD</strong></p><p><img loading="lazy" src="/ocp-gitp/assets/images/ad-sites-after-397c50a65e93313ea88fdf48c6bd29d4.png" width="858" height="406" class="img_ev3q"></p><p><strong>DNS</strong></p><p><img loading="lazy" src="/ocp-gitp/assets/images/ad-dns-after-be29b0a19d676ddcdfa0ae22db9261b2.png" width="1015" height="690" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="check-replication-status">Check Replication Status<a href="#check-replication-status" class="hash-link" aria-label="Direct link to Check Replication Status" title="Direct link to Check Replication Status">​</a></h4><p>Once the additional domain controller is deployed you can check the replciation status. </p><ol><li><p>Open Active Directory Users and Services and check for existance of user records</p></li><li><p>If replication is not complete, open PowerShell and run the following command</p><div class="language-PowerShell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-PowerShell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">repadmin /replsummary</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>The lowest setting is 15 minutes. However this can be changed to immediate by configuring the following registry key. Note that this is not recommended in production environment and decision should be made considering the available bandwidth and compute resources for the domain controllers.</p><p><a href="https://www.itgeared.com/modifying-behavior-of-inter-site/" target="_blank" rel="noopener noreferrer">Here</a> is an article to accomplish this.</p></div></div></li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/ocp-gitp/tags/csi">csi</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/ocp-gitp/tags/topology">topology</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/ocp-gitp/tags/idp">idp</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/ocp-gitp/tags/dns">dns</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/ocp-gitp/tags/instructions">instructions</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/nutanix-japan/ocp-gitp/edit/main/docs/ocp_topology/infra_topology.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-05-17T15:22:38.000Z">May 17, 2023</time></b> by <b>Nutanix Japan</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#design-overview" class="table-of-contents__link toc-highlight">Design Overview</a></li><li><a href="#pre-requisites" class="table-of-contents__link toc-highlight">Pre-requisites</a></li><li><a href="#idp-and-dns-implementation-1" class="table-of-contents__link toc-highlight">IDP and DNS Implementation</a><ul><li><a href="#upload-images" class="table-of-contents__link toc-highlight">Upload Images</a></li><li><a href="#create-primary-ad-and-dns-vm" class="table-of-contents__link toc-highlight">Create Primary AD and DNS VM</a></li><li><a href="#prepare-ad-sites-and-services" class="table-of-contents__link toc-highlight">Prepare AD Sites and Services</a></li><li><a href="#implement-dns-best-practices" class="table-of-contents__link toc-highlight">Implement DNS Best Practices</a></li><li><a href="#deploy-additional-ad-and-dns-controllers" class="table-of-contents__link toc-highlight">Deploy Additional AD and DNS Controllers</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Nutanix. Built with Docusaurus.</div></div></div></footer></div>
<script src="/ocp-gitp/assets/js/runtime~main.a3558648.js"></script>
<script src="/ocp-gitp/assets/js/main.f111c460.js"></script>
</body>
</html>